<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>More Translator - è°ƒè¯•æ¨¡å¼</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007AFF;
            background: #f0f8ff;
        }
        .error {
            border-left-color: #FF3B30;
            background: #fff5f5;
        }
        .success {
            border-left-color: #34C759;
            background: #f0fff4;
        }
        .warning {
            border-left-color: #FF9500;
            background: #fffbf0;
        }
        .log-area {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056CC;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ More Translator - è°ƒè¯•æ¨¡å¼</h1>
        
        <div class="status" id="appStatus">
            <h3>åº”ç”¨çŠ¶æ€</h3>
            <p>æ­£åœ¨æ£€æŸ¥åº”ç”¨çŠ¶æ€...</p>
        </div>
        
        <div class="test-section">
            <h3>åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="testTranslation()">æµ‹è¯•ç¿»è¯‘åŠŸèƒ½</button>
            <button onclick="testClipboard()">æµ‹è¯•å‰ªè´´æ¿</button>
            <button onclick="checkPermission()">æ£€æŸ¥æƒé™</button>
            <button onclick="showLogs()">æŸ¥çœ‹æ—¥å¿—</button>
        </div>
        
        <div class="test-section">
            <h3>ç¿»è¯‘æµ‹è¯•</h3>
            <input type="text" id="testText" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„è‹±æ–‡æ–‡æœ¬" style="width: 300px; padding: 8px; margin-right: 10px;">
            <button onclick="translateTest()">ç¿»è¯‘</button>
            <div id="translationResult" style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 5px; display: none;"></div>
        </div>
        
        <div class="log-area" id="logArea" style="display: none;">
            <div>æ—¥å¿—å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
        </div>
        
        <div class="status warning">
            <h3>ä½¿ç”¨è¯´æ˜</h3>
            <p>1. ç¡®ä¿å·²æˆäºˆè¾…åŠ©åŠŸèƒ½æƒé™</p>
            <p>2. é€‰æ‹©è‹±æ–‡æ–‡æœ¬åæŒ‰ CMD+Shift+T</p>
            <p>3. ç‚¹å‡»å‡ºç°çš„ç¿»è¯‘æŒ‰é’®</p>
            <p>4. æŸ¥çœ‹ç¿»è¯‘ç»“æœ</p>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥çŠ¶æ€
        window.addEventListener('DOMContentLoaded', async () => {
            updateStatus('åº”ç”¨å·²å¯åŠ¨ï¼Œæ­£åœ¨æ£€æŸ¥çŠ¶æ€...');
            
            try {
                // æ£€æŸ¥æƒé™
                const hasPermission = await ipcRenderer.invoke('check-permission');
                if (hasPermission) {
                    updateStatus('âœ… è¾…åŠ©åŠŸèƒ½æƒé™å·²æˆäºˆ', 'success');
                } else {
                    updateStatus('âŒ éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™', 'error');
                }
            } catch (error) {
                updateStatus('âŒ æ£€æŸ¥æƒé™å¤±è´¥: ' + error.message, 'error');
            }
        });
        
        function updateStatus(message, type = 'status') {
            const statusDiv = document.getElementById('appStatus');
            statusDiv.className = 'status ' + type;
            statusDiv.innerHTML = '<h3>åº”ç”¨çŠ¶æ€</h3><p>' + message + '</p>';
        }
        
        async function testTranslation() {
            try {
                updateStatus('æ­£åœ¨æµ‹è¯•ç¿»è¯‘åŠŸèƒ½...', 'warning');
                const result = await ipcRenderer.invoke('translate-text', 'hello world');
                updateStatus('âœ… ç¿»è¯‘åŠŸèƒ½æ­£å¸¸: ' + result, 'success');
            } catch (error) {
                updateStatus('âŒ ç¿»è¯‘åŠŸèƒ½æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        async function testClipboard() {
            try {
                const text = await ipcRenderer.invoke('get-selected-text');
                updateStatus('âœ… å‰ªè´´æ¿åŠŸèƒ½æ­£å¸¸ï¼Œå½“å‰å†…å®¹: ' + (text || 'ç©º'), 'success');
            } catch (error) {
                updateStatus('âŒ å‰ªè´´æ¿åŠŸèƒ½æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        async function checkPermission() {
            try {
                const hasPermission = await ipcRenderer.invoke('check-permission');
                if (hasPermission) {
                    updateStatus('âœ… è¾…åŠ©åŠŸèƒ½æƒé™å·²æˆäºˆ', 'success');
                } else {
                    updateStatus('âŒ éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™', 'error');
                }
            } catch (error) {
                updateStatus('âŒ æƒé™æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        async function showLogs() {
            const logArea = document.getElementById('logArea');
            logArea.style.display = logArea.style.display === 'none' ? 'block' : 'none';
            
            if (logArea.style.display === 'block') {
                // è¿™é‡Œå¯ä»¥æ·»åŠ è¯»å–æ—¥å¿—æ–‡ä»¶çš„é€»è¾‘
                logArea.innerHTML = '<div>æ—¥å¿—æ–‡ä»¶ä½ç½®: ~/Library/Application Support/More Translator/app.log</div>';
            }
        }
        
        async function translateTest() {
            const text = document.getElementById('testText').value;
            const resultDiv = document.getElementById('translationResult');
            
            if (!text) {
                alert('è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬');
                return;
            }
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = 'æ­£åœ¨ç¿»è¯‘...';
                
                const result = await ipcRenderer.invoke('translate-text', text);
                resultDiv.innerHTML = '<strong>åŸæ–‡:</strong> ' + text + '<br><strong>è¯‘æ–‡:</strong> ' + result;
            } catch (error) {
                resultDiv.innerHTML = '<strong>ç¿»è¯‘å¤±è´¥:</strong> ' + error.message;
            }
        }
    </script>
</body>
</html>

